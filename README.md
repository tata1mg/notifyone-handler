## Introduction
This repository is the part of the open source [NotifyOne](https://github.com/tata1mg/notifyone) project.

'notifyone-handler' provides handlers implementation for the supported channels (channels of notifications i.e. 
sms/email/push/whatsapp etc.) in the NotifyOne project.

### Supported channels & gateways for each channel
    > email     - ["SparkPost", "AWS SES"]
    > sms       - ["SMS COUNTRY", "Plivo"]
    > push      - ["FCM"]
    > whatsapp  - ["Interkt"]

### Tech Stack 
    python version - 3.9.10
    framework      - [torpedo] (a lightweight wrapper around the open source Sanic framework)

## Features
    > Supports muli deployment - handler for each channel can be deplyed seprately
    
    > Default priority logic b/w gateways for a channel - this is used to decide the gateway for a communication request
    
    > Custom Priority Logic - you can write a dynamic priotity logic based on the parameters availble in the request.  
        Custom priority logic can be used to overwirte the default priority logic.
    
    > Support for the multiple instances for the same gateway.
    
    > Adding new gateway (from the supported gateways list) is as easy as adding a config in your service.

## Configurations Available
For the list of all available keys, checkout the [Config Template]() file.

[Config Template]() provides a template (actual keys, dummy values) for the actual config file.

The actual config.json file must be generated by the service owner with the real values. 

#### Config Keys
    config.NAME     : Name of the service
    config.HOST     : Host name for interface binding. Default value - 0.0.0.0
    config.PORT     : Port for the service
    config.WORKER   : Number of Sanic works. Default is 1
    config.DEBUG    : Available values [true/false]. If set to true, the service runs in DEBUG mode
    config.TIMEOUT  : Default timeout for all the http APIs exposed
    config.SENTRY   : Sentry configuraition details. Leave it empty if sentry integration is not needed
    config.APM      : APM configurtion. Leave it empty if APM integration is not needed
    config.SQS      : SQS queue details for PUBLISH and SUBSCRIBE
    config.SQS.PUBLISH.LOGGING  : SQS queue details for status updates
    config.SQS.SUBSCRIBE.EMAIL  : SQS queue details for `email` channel
    config.SQS.SUBSCRIBE.SMS  : SQS queue details for `sms` channel
    config.SQS.SUBSCRIBE.PUSH  : SQS queue details for `push` channel
    config.SQS.SUBSCRIBE.WHATSAPP  : SQS queue details for `whatsapp` channel
    config.SQS_AUTH : SQS auth credentitals
    config.ENABLED_CHANNELS : List of channels active for this deployment. This config key can be used to control the 
                                channel handlers active in a deployment.  
###### The config file has keys for handlers configurations for each channel config.SMS_HANDLER, config.EMAIL_HANDLER, config.PUSH_HANDLER and config.WHATSAPP_HANDLER are the handlers for sms, email, push and whatsapp channels respectively. 
###### Each handler config has got same set of keys. So, we have explained the handlers config keys only for config.SMS_HANDLER here. For rest of the handlers, meaning of the keys remains the same.   
    config.SMS_HANDLER  : SMS handler configuration
    config.SMS_HANDLER.DEFAULT_PRIORITY : Default priority of configured gateways
    config.SMS_HANDLER.PRIORITY_LOGIC   : Custom priority logic. A python one-liner eval expression that returns gateways priority for current request.
                                            config.SMS_HANDLER.PRIORITY_LOGIC takes presendece over config.SMS_HANDLER.DEFAULT_PRIORITY
                                            You can use variable `data` to refer to the request details in you custom logic. 
                                            Example - 
                                            config.SMS_HANDLER.PRIORITY_LOGIC: """['GATEWAY2', 'GATEWAY1'] if data.get('to') == '<customer1_number>' else ['GATEWAY1', 'GATEWAY2']"""
    config.SMS_HANDLER.GATEWAYS         : A list of all the configured gateways. See the config template for details 
                                            about how to add gateways here. 


## Setup
### Multi service Vs Single service deployment
### EC2 and Container based deployment
### Steps

## Contribution guidelines



## How to raise issues
Please use [GitHub Issues](https://github.com/tata1mg/notifyone-handler/issues) to raise any bug or request a feature.


## Discussions
Please use [GitHub Discussions](https://github.com/tata1mg/notifyone-handler/discussions) to discuss the topics related to this project.


## License
This project is licensed under the
[Apache-2.0](https://github.com/tata1mg/notifyone-handler/blob/master/LICENSE) License.